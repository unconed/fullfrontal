var \u03c0=Math.PI,\u03c4=2*\u03c0;(function(a){for(var b in a)if(!window[b])throw"Error: ThreeBox requires "+a[b];})({THREE:"Three.js",tQuery:"tQuery.js (bundle)"});window.ThreeBox={};window.threeBox=function(a,b){a&&!(a instanceof Node)&&(b=a,a=null);return tQuery.createWorld(b).threeBox(a,b)};MicroEvent.prototype.on=function(){MicroEvent.prototype.bind.apply(this,arguments);return this};MicroEvent.prototype.emit=function(){MicroEvent.prototype.trigger.apply(this,arguments);return this};
MicroEvent.mixin=function(a){for(var b=["bind","unbind","trigger","on","emit"],c=0;c<b.length;c++)a.prototype[b[c]]=MicroEvent.prototype[b[c]]};tQuery.World.prototype.on=tQuery.World.prototype.addEventListener;tQuery.World.prototype.emit=tQuery.World.prototype.dispatchEvent;
tQuery.World.registerInstance("threeBox",function(a,b){a&&!(a instanceof Node)&&(b=a,a=null);var c=a=a||document.body;a==document.body?(c.style.margin=0,c.style.padding=0,c.style.overflow="hidden"):(getComputedStyle(a),"static"==a.position&&(a.position="relative"));this.appendTo(c);this.addThreeBox(a,b||{});return this});
tQuery.World.registerInstance("addThreeBox",function(a,b){console.assert(!0!==this.hasThreeBox());b=tQuery.extend(b,{cameraControls:!1,cursor:!0,controlClass:ThreeBox.OrbitControls,elementResize:!0,fullscreen:!0,screenshot:!0,stats:!0,scale:1});this.tRenderer().domElement.style.display="block";var c={};tQuery.data(this,"_threeBoxContext",c);var d=this.tCamera(),e=this.tRenderer();b.stats&&(c.stats=new Stats,c.stats.domElement.style.position="absolute",c.stats.domElement.style.left="10px",c.stats.domElement.style.top=
"10px",a&&a.appendChild(c.stats.domElement),c.loopStats=function(){c.stats.update()},this.loop().hook(c.loopStats));if(b.cameraControls){var f=this.loop(),g=this.render.bind(this);c.cameraControls=new b.controlClass(d,a,b);if(c.cameraControls.on)c.cameraControls.on("change",function(){f._timerId||g()});this.setCameraControls(c.cameraControls)}b.elementResize&&(c.elementResize=ThreeBox.ElementResize.bind(e,d,a,b).on("resize",function(a,b){this._opts.renderW=a;this._opts.renderH=b;this.emit("resize",
a,b)}.bind(this)));null!==b.cursor&&(c.cursor=ThreeBox.Cursor.bind(a,b));THREEx&&(THREEx.Screenshot&&b.screenshot)&&(c.screenshot=THREEx.Screenshot.bindKey(e));THREEx&&(THREEx.FullScreen&&b.fullscreen&&THREEx.FullScreen.available())&&(c.fullscreen=THREEx.FullScreen.bindKey());c._$onDestroy=this.bind("destroy",function(){!1!==this.hasThreeBox()&&this.removeThreeBox()});return this});tQuery.World.registerInstance("hasThreeBox",function(){return void 0===tQuery.data(this,"_threeBoxContext")?!1:!0});
tQuery.World.registerInstance("removeThreeBox",function(){var a=tQuery.data(this,"_threeBoxContext");if(void 0===a)return this;tQuery.removeData(this,"_threeBoxContext");this.unbind("destroy",this._$onDestroy);a.stats&&(document.body.removeChild(a.stats.domElement),this.loop().unhook(a.loopStats));a.cameraControls&&this.removeCameraControls()&&a.cameraControls.stop();a.elementResize&&a.elementResize.unbind();a.cursor&&a.cursor.unbind();a.screenshot&&a.screenshot.unbind();a.fullscreen&&a.fullscreen.unbind()});
ThreeBox.ElementResize=function(a,b,c,d){this.scale=d.scale||1;this.orbit=d.orbit;d=this.callback=function(){var d=Math.floor(c.offsetWidth),f=Math.floor(c.offsetHeight);a.domElement.style.position="absolute";a.domElement.style.width=d+"px";a.domElement.style.height=f+"px";var g=Math.floor(d/this.scale),h=Math.floor(f/this.scale);a.setSize(g,h);b.aspect=d/f;b instanceof THREE.OrthographicCamera&&(b.top=this.orbit/2,b.bottom=-b.top,b.left=-b.top*b.aspect,b.right=-b.bottom*b.aspect);b.updateProjectionMatrix();
this.emit("resize",g,h)}.bind(this);window.addEventListener("resize",d,!1);c.addEventListener("resize",d,!1);setTimeout(d,0)};ThreeBox.ElementResize.bind=function(a,b,c,d){return new ThreeBox.ElementResize(a,b,c,d)};ThreeBox.ElementResize.prototype.scale=function(a){this.scale=a};ThreeBox.ElementResize.prototype.unbind=function(){window.removeEventListener("resize",callback);domElement.removeEventListener("resize",callback)};MicroEvent.mixin(ThreeBox.ElementResize);
ThreeBox.OrbitControls=function(a,b,c){this.element=b;this.camera=a;this.options=tQuery.extend(c,{phi:\u03c4/4,theta:0.3,orbit:2,lookAt:[0,0,0],speed:2});this.init();this.start();this.update()};
ThreeBox.OrbitControls.prototype={init:function(){this.width=this.element&&this.element.offsetWidth;this.height=this.element&&this.element.offsetHeight;this.phi=this.options.phi;this.theta=this.options.theta;this.orbit=this.options.orbit;this.speed=this.options.speed;this.lookAt=new THREE.Vector3;this.lookAt.set.apply(this.lookAt,this.options.lookAt||[]);this.width||console.warn("ThreeBox container has width 0");this.height||console.warn("ThreeBox container has height 0")},start:function(){var a=
this;this._mouseDown=function(b){a.width=a.element&&a.element.offsetWidth;a.height=a.element&&a.element.offsetHeight;a.drag=!0;a.lastHover=a.origin={x:b.pageX,y:b.pageY};b.preventDefault()};this._mouseUp=function(){a.drag=!1};this._mouseMove=function(b){if(a.drag){var c={x:b.pageX-a.origin.x,y:b.pageY-a.origin.y},d={x:b.pageX-a.lastHover.x,y:b.pageY-a.lastHover.y};a.lastHover={x:b.pageX,y:b.pageY};a.moved(a.origin,c,d)}};this.element&&(this.element.addEventListener("mousedown",this._mouseDown,!1),
document.addEventListener("mouseup",this._mouseUp,!1),document.addEventListener("mousemove",this._mouseMove,!1))},stop:function(){this.element&&(this.element.removeEventListener("mousedown",this._mouseDown),document.removeEventListener("mouseup",this._mouseUp),document.removeEventListener("mousemove",this._mouseMove))},moved:function(a,b,c){this.phi+=c.x*this.speed/Math.max(1,this.width);this.theta=Math.min(\u03c0/2,Math.max(-\u03c0/2,this.theta+c.y*this.speed/Math.max(1,this.height)));this.emit("change")},
update:function(){this.camera.position.x=Math.cos(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.y=Math.sin(this.theta)*this.orbit;this.camera.position.z=Math.sin(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.addSelf(this.lookAt);this.camera.lookAt(this.lookAt)}};ThreeBox.OrbitControls.bind=function(a,b,c){return new ThreeBox.OrbitControls(a,b,c)};MicroEvent.mixin(ThreeBox.OrbitControls);
ThreeBox.Cursor=function(a,b){function c(){f||(a.style.cursor=d);clearTimeout(e);f=!1;e=setTimeout(function(){f=!0;a.style.cursor="none"},g)}var d=b.cameraControls?"move":"default",e=null,f=!1,g=2E3;b.cursor?a.style.cursor=d:(a.addEventListener("mousemove",c),a.style.cursor="none");return{unbind:function(){a.removeEventListener("mousemove",c)}}};ThreeBox.Cursor.bind=function(a,b){return ThreeBox.Cursor(a,b)};
ThreeBox.preload=function(a,b){a instanceof Function&&(b=a,a=[]);a="string"==typeof a?[a]:a;var c=a.length,d={},e=function(a){_.extend(d,a||{});0==--c&&b(d)},f=ThreeBox.preload,g={},h={html:f.html,jpg:f.image,png:f.image,gif:f.image,mp3:f.audio};_.each(h,function(a,b){g[b]=RegExp("\\."+b+"$")});_.each(a,function(a){_.each(h,function(b,c){if(a.match(g[c])){var d=a.split(/\//g).pop().replace(/\.[A-Za-z0-9]+$/,"");b(a,d,e)}})})};
ThreeBox.preload.html=function(a,b,c){new microAjax(a,function(b){var e;(e=b.match(/^<script[^>]*type=['"]text\/javascript['"][^>]*>([\s\S]+?)<\/script>$/m))?(b=document.createElement("script"),b.type="text/javascript",b.innerHTML=e[1],document.body.appendChild(b)):(e=document.createElement("div"),e.innerHTML=b,document.body.appendChild(e));console.log("Loaded HTML ",a);c()})};
ThreeBox.preload.image=function(a,b,c){THREE.ImageUtils.loadTexture(a,null,function(d){var e={};e[b]=d;console.log("Loaded texture ",a);c(e)})};ThreeBox.preload.audio=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){var e={};e[b]=d.response;console.log("Loaded audio ",a);c(e)};d.send()};
